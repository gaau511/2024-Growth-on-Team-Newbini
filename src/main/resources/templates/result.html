
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Quiz</title>
    <style>
        /* CSS 스타일 */
        .quiz-container {
            max-width: 600px;
            margin: 0 auto;
            font-family: Arial, sans-serif;
        }

        .question {
            position: relative;
            background-color: #EEE6FF;
            border: 2px solid #D4BFFF;
            border-radius: 30px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .question.correct {
            background-color: #CEFFC4;
            border: 2px solid #93FF7D;
        }

        .question.incorrect {
            background-color: #FFE4E0;
            border: 2px solid #FF7361;
        }

        .question-text {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .answer-options {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }

        .answer-options li {
            margin : 5px;
            margin-bottom: 5px;
        }

        .answer-options input[type="radio"] {
            margin : 5px;
            margin-right: 5px;
        }

        .answer {
            display: none;
            background-color: #FFFFFF;
            border-radius: 15px;
            padding : 10px;
            margin : 7px;
        }

        .short-answer {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 14px;
        }

       .bookmark-btn {
            position: absolute;
            top: 20px;
            right: -80px;
            font-size: 12px;
            color: #333;
            text-decoration: none;
       }

       .bookmark-btn:hover {
            color: #666;
       }
    </style>

</head>
<body>
<div th:if="${jsonError}">
    <h3>다시 시도해주세요!</h3>
    <pre th:text="${jsonError}"></pre>
</div>

<div class="quiz-container">
    <div th:each="question, iterStat : ${quiz.questions}">
        <div th:switch="${question.type}" class="question">
            <div th:case="'객관식'" class="multiple">
                    <h3 class="question-text" th:text="${iterStat.count} + '. ' + ${question.question}"></h3>
                    <ul class="answer-options multiple" >
                        <li th:each="option, optionStat : ${question.options}">
                            <input type="radio" th:value="${option}" th:id="${'q' + iterStat.count + '-' + optionStat.count}" th:name="${'q' + iterStat.count}"/>
                            <label th:for="${'q' + iterStat.count + '-' + optionStat.count}" th:text="${option}"></label>
                        </li>
                    </ul>
                    <div th:class="|answer answer-q${iterStat.count}|">
                        <span th:text="|정답 : ${question.answer}|">정답</span>
                    </div>
            </div>
            <div th:case="'주관식'" class="essay">
                <h3 class="question-text" th:text="${iterStat.count} + '. ' + ${question.question}"></h3>
                <input type="text" class="short-answer" />
                <span th:text="${question.answer}" style="display:none;"></span>
                <div th:class="|answer answer-q${iterStat.count}|">
                    <span th:text="|정답 : ${question.answer}|">정답</span>
                </div>
            </div>
            <div th:case="'O/X'" class="OX">
                <h3 class="question-text" th:text="${iterStat.count} + '. ' + ${question.question}"></h3>
                <ul class="answer-options">
                    <li>
                        <input type="radio" th:id="${'q' + iterStat.count + '-true'}" th:name="'q' + ${iterStat.count}" value="true" />
                        <label th:for="${'q' + iterStat.count + '-true'}">O</label>
                    </li>
                    <li>
                        <input type="radio" th:id="${'q' + iterStat.count + '-false'}" th:name="'q' + ${iterStat.count}" value="false" />
                        <label th:for="${'q' + iterStat.count + '-false'}">X</label>
                    </li>
                </ul>
                <div th:class="|answer answer-q${iterStat.count}|">
                    <span th:text="|정답 : ${question.answer}|">정답</span>
                </div>
            </div>
        </div>
    </div>
    <button id="submit-button">채점하기</button>
</div>

<script th:inline="javascript">

    document.getElementById('submit-button').addEventListener('click', function() {

        const questions = document.querySelectorAll('.question');
        let answers = [];
        [[${quiz.questions}]].forEach(function(question) {
            answers.push(question.answer);
        });

        let score = 0;
        questions.forEach((question, index) => {
        const type = question.querySelector('div').className;
        const answer = answers[index];

        console.log(type);
        console.log(answer);

        switch (type) {
            case 'multiple':
                var selectedOption = question.querySelector('input[type="radio"]:checked');
                console.log(selectedOption);
                if (selectedOption) {
                    const userAnswer = selectedOption.value;
                    console.log(userAnswer);
                    if (userAnswer === answer) {
                        score++;
                        console.log(score);
                        question.classList.add('correct');
                    } else {
                        question.classList.add('incorrect');
                    }
                }
                else {
                    question.classList.add('unsolved');
                }
                break;
            case 'essay':
                const userAnswer = question.querySelector('input[type="text"]').value;
                if (userAnswer) {
                    if (userAnswer.trim().toLowerCase() === answer.trim().toLowerCase()) {
                        score++;
                        question.classList.add('correct');
                    } else {
                        question.classList.add('incorrect');
                    }
                } else {
                    question.classList.add('unsolved');
                }
                break;
            case 'OX':
                var selectedOption = question.querySelector('input[type="radio"]:checked');
                if (selectedOption) {
                    const userAnswer = selectedOption.value;
                    if (userAnswer === answer) {
                    score++;
                    question.classList.add('correct');
                    } else {
                        question.classList.add('incorrect');
                    }
                }
                else {
                    question.classList.add('unsolved');
                }
                break;
        }

        const button = document.createElement('button');
        button.textContent = '북마크';
        button.classList.add('bookmark-btn');

        button.addEventListener('click', function() {
            alert('북마크 되었습니다.');
        });

        question.appendChild(button);
        });

        document.querySelectorAll('.answer').forEach(function(element) {
            element.style.display = 'flex';
        });

        document.querySelectorAll('.short-answer').forEach(function(element) {
            element.disabled = true;
        });



    });
</script>
</body>
</html>